{"version":3,"file":"geocode.js","sources":["webpack://opencage-api-client/./src/geocode.ts"],"sourcesContent":["import { GeocodingRequest } from './types/GeocodingRequest';\nimport { GeocodingResponse } from './types/GeocodingResponse';\nimport { fetchUrl } from './fetch';\nimport {\n  buildValidationError,\n  isUndefinedOrNull,\n  buildQueryString,\n  buildQuery,\n} from './helpers/geocodeHelpers';\n\nconst MISSING_OR_BAD_QUERY = 'missing or bad query';\nconst MISSING_API_KEY = 'missing API key';\n\n/**\n * geocode address and reverse geocode coordinates using\n * [OpenCage API](https://opencagedata.com/api) requesting the json format.\n *\n * @param  {Object} input the input query parameter as JSON object,\n *  the attribute `q` is required, the `key` can be omitted when using\n *  a `proxyURL`, and when using node with a dedicated environment variable\n *  (OPENCAGE_API_KEY).\n *  Others optional parameters can be found at OpenCage Data API\n *  [documentation](https://opencagedata.com/api#forward-opt)\n *\n * @return {Promise} a promise resolved by the json format API payload\n */\nexport async function geocode(\n  input: GeocodingRequest\n): Promise<GeocodingResponse> {\n  return new Promise((resolve, reject) => {\n    if (isUndefinedOrNull(input)) {\n      const error = buildValidationError(400, MISSING_OR_BAD_QUERY);\n      reject(error);\n      return;\n    }\n    const params = buildQuery(input);\n    if (params.missingKey) {\n      const error = buildValidationError(401, MISSING_API_KEY);\n      reject(error);\n      return;\n    }\n    const { query, endpoint } = params;\n    const qs = buildQueryString(query);\n    const url = `${endpoint}?${qs}`;\n    // console.debug(url);\n    fetchUrl(url, resolve, reject);\n  });\n}\n"],"names":["MISSING_OR_BAD_QUERY","MISSING_API_KEY","geocode","input","Promise","resolve","reject","isUndefinedOrNull","error","buildValidationError","params","buildQuery","query","endpoint","qs","buildQueryString","url","fetchUrl"],"mappings":";;AAUA,MAAMA,uBAAuB;AAC7B,MAAMC,kBAAkB;AAejB,eAAeC,QACpBC,KAAuB;IAEvB,OAAO,IAAIC,QAAQ,CAACC,SAASC;QAC3B,IAAIC,kBAAkBJ,QAAQ;YAC5B,MAAMK,QAAQC,qBAAqB,KAAKT;YACxCM,OAAOE;YACP;QACF;QACA,MAAME,SAASC,WAAWR;QAC1B,IAAIO,OAAO,UAAU,EAAE;YACrB,MAAMF,QAAQC,qBAAqB,KAAKR;YACxCK,OAAOE;YACP;QACF;QACA,MAAM,EAAEI,KAAK,EAAEC,QAAQ,EAAE,GAAGH;QAC5B,MAAMI,KAAKC,iBAAiBH;QAC5B,MAAMI,MAAM,GAAGH,SAAS,CAAC,EAAEC,IAAI;QAE/BG,SAASD,KAAKX,SAASC;IACzB;AACF"}