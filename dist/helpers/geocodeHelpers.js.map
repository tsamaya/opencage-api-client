{"version":3,"file":"helpers/geocodeHelpers.js","sources":["webpack://opencage-api-client/./src/helpers/geocodeHelpers.ts"],"sourcesContent":["import { GeocodeRequest } from '../types/GeocodeRequest';\nimport { GeocodeError, GeocodeErrorStatus } from '../errors/GeocodeError';\n\nconst OPENCAGEDATA_JSON_URL = 'https://api.opencagedata.com/geocode/v1/json';\n\n/**\n * @private\n * @description Returns a {GeocodeError} object with status (validation error)\n * @param code {number} HTTP status code\n * @param message {string} error message\n * @returns {GeocodeError}\n *\n */\nexport function buildValidationError(code: number, message: string) {\n  const error = new GeocodeError(message);\n  const status: GeocodeErrorStatus = {\n    code,\n    message,\n  };\n  error.status = status;\n  error.response = { status };\n  return error;\n}\n\n/**\n * @private\n * @description checks the response status and throws an error if the status is not ok\n * @param response {Response} the response object\n * @returns {Response} the response object\n * @throws {GeocodeError} the error object\n */\nexport function checkFetchStatus(response: Response) {\n  if (response.status >= 200 && response.status < 300) {\n    return response;\n  }\n  const error = new GeocodeError(response.statusText);\n  error.status = {\n    code: response.status,\n    message: response.statusText,\n  };\n  error.response = response;\n  throw error;\n}\n\nexport function parseJSON(response: Response) {\n  return response.json();\n}\n/**\n * @private\n * returns true is `param` is not defined or empty\n * @param  {String}  param object property as a string\n * @return {Boolean}       returns value\n */\nexport function isUndefinedOrEmpty(param: string | null | undefined): boolean {\n  return typeof param === 'undefined' || param === '';\n}\n\n/**\n * @private\n * returns true is `param` is not defined or null\n * @param  {String}  param object property as a string\n * @return {Boolean}       returns value\n */\nexport function isUndefinedOrNull(\n  param: GeocodeRequest | null | undefined\n): boolean {\n  return typeof param === 'undefined' || param === null;\n}\n\n/**\n * @private\n *\n * @param input\n * @returns the request query string\n */\nexport function buildQueryString(input: any): string {\n  if (isUndefinedOrNull(input)) {\n    return '';\n  }\n  return Object.keys(input)\n    .map(\n      (key) =>\n        `${encodeURIComponent(key)}=${encodeURIComponent(input[key] || '')}`\n    )\n    .join('&');\n}\n\n/**\n * @private\n * Builds the query params including key and proxy URL\n *\n * @param {*} input\n */\nexport function buildQuery(input: GeocodeRequest) {\n  const query = { ...input };\n  let endpoint = OPENCAGEDATA_JSON_URL;\n  let missingKey = false;\n  if (!isUndefinedOrEmpty(input.proxyURL)) {\n    endpoint = input.proxyURL as string;\n    delete query.proxyURL;\n  } else {\n    if (isUndefinedOrEmpty(input.key)) {\n      query.key = process.env.OPENCAGE_API_KEY;\n    }\n    if (isUndefinedOrEmpty(query.key)) {\n      missingKey = true;\n    }\n  }\n  return {\n    missingKey,\n    endpoint,\n    query,\n  };\n}\n"],"names":["OPENCAGEDATA_JSON_URL","buildValidationError","code","message","error","GeocodeError","status","checkFetchStatus","response","parseJSON","isUndefinedOrEmpty","param","isUndefinedOrNull","buildQueryString","input","Object","key","encodeURIComponent","buildQuery","query","endpoint","missingKey","process"],"mappings":";AAGA,MAAMA,wBAAwB;AAUvB,SAASC,qBAAqBC,IAAY,EAAEC,OAAe;IAChE,MAAMC,QAAQ,IAAIC,aAAaF;IAC/B,MAAMG,SAA6B;QACjCJ;QACAC;IACF;IACAC,MAAM,MAAM,GAAGE;IACfF,MAAM,QAAQ,GAAG;QAAEE;IAAO;IAC1B,OAAOF;AACT;AASO,SAASG,iBAAiBC,QAAkB;IACjD,IAAIA,SAAS,MAAM,IAAI,OAAOA,SAAS,MAAM,GAAG,KAC9C,OAAOA;IAET,MAAMJ,QAAQ,IAAIC,aAAaG,SAAS,UAAU;IAClDJ,MAAM,MAAM,GAAG;QACb,MAAMI,SAAS,MAAM;QACrB,SAASA,SAAS,UAAU;IAC9B;IACAJ,MAAM,QAAQ,GAAGI;IACjB,MAAMJ;AACR;AAEO,SAASK,UAAUD,QAAkB;IAC1C,OAAOA,SAAS,IAAI;AACtB;AAOO,SAASE,mBAAmBC,KAAgC;IACjE,OAAO,AAAiB,WAAVA,SAAyBA,AAAU,OAAVA;AACzC;AAQO,SAASC,kBACdD,KAAwC;IAExC,OAAO,QAAOA;AAChB;AAQO,SAASE,iBAAiBC,KAAU;IACzC,IAAIF,kBAAkBE,QACpB,OAAO;IAET,OAAOC,OAAO,IAAI,CAACD,OAChB,GAAG,CACF,CAACE,MACC,GAAGC,mBAAmBD,KAAK,CAAC,EAAEC,mBAAmBH,KAAK,CAACE,IAAI,IAAI,KAAK,EAEvE,IAAI,CAAC;AACV;AAQO,SAASE,WAAWJ,KAAqB;IAC9C,MAAMK,QAAQ;QAAE,GAAGL,KAAK;IAAC;IACzB,IAAIM,WAAWpB;IACf,IAAIqB,aAAa;IACjB,IAAKX,mBAAmBI,MAAM,QAAQ,GAG/B;QACL,IAAIJ,mBAAmBI,MAAM,GAAG,GAC9BK,MAAM,GAAG,GAAGG,QAAQ,GAAG,CAAC,gBAAgB;QAE1C,IAAIZ,mBAAmBS,MAAM,GAAG,GAC9BE,aAAa;IAEjB,OAVyC;QACvCD,WAAWN,MAAM,QAAQ;QACzB,OAAOK,MAAM,QAAQ;IACvB;IAQA,OAAO;QACLE;QACAD;QACAD;IACF;AACF"}