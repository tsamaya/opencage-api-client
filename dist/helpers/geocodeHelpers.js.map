{"version":3,"file":"helpers/geocodeHelpers.js","sources":["webpack://opencage-api-client/./src/helpers/geocodeHelpers.ts"],"sourcesContent":["import { GeocodingRequest } from '../types/GeocodingRequest';\nimport { GeocodeError, GeocodeErrorStatus } from '../errors/GeocodeError';\nimport { GeocodingOptions } from '../types/GeocodingOptions';\n\nconst OPENCAGEDATA_JSON_URL = 'https://api.opencagedata.com/geocode/v1/json';\n\n/**\n * @private\n * @description Returns a {GeocodeError} object with status (validation error)\n * @param code {number} HTTP status code\n * @param message {string} error message\n * @returns {GeocodeError}\n *\n */\nexport function buildValidationError(code: number, message: string) {\n  const error = new GeocodeError(message);\n  const status: GeocodeErrorStatus = {\n    code,\n    message,\n  };\n  error.status = status;\n  error.response = { status };\n  return error;\n}\n\n/**\n * @private\n * returns true is `param` is not defined or empty\n * @param  {String}  param object property as a string\n * @return {Boolean}       returns value\n */\nexport function isUndefinedOrEmpty(param: string | null | undefined): boolean {\n  return typeof param === 'undefined' || param === '';\n}\n\n/**\n * @private\n * returns true is `param` is not defined or null\n * @param  {String}  param object property as a string\n * @return {Boolean}       returns value\n */\nexport function isUndefinedOrNull(\n  param: GeocodingRequest | null | undefined\n): boolean {\n  return typeof param === 'undefined' || param === null;\n}\n\n/**\n * @private\n *\n * @param input\n * @returns the request query string\n */\nexport function buildQueryString(input: any): string {\n  if (isUndefinedOrNull(input)) {\n    return '';\n  }\n  return Object.keys(input)\n    .map(\n      (key) =>\n        `${encodeURIComponent(key)}=${encodeURIComponent(input[key] || '')}`\n    )\n    .join('&');\n}\n\n/**\n * @private\n * Builds the query params including key and proxy URL\n *\n * @param {GeocodingRequest} input\n * @param {GeocodingOptions} options\n * @returns {Object}  {\n *   missingKey: boolean,\n *   endpoint: string,\n *   query: GeocodingRequest copy of the input object with the proxyURL removed\n * }\n */\nexport function buildQuery(\n  input: GeocodingRequest,\n  options?: GeocodingOptions\n) {\n  const query = { ...input };\n  let endpoint = OPENCAGEDATA_JSON_URL;\n  let missingKey = false;\n  if (\n    !isUndefinedOrEmpty(input.proxyURL) ||\n    !isUndefinedOrEmpty(options?.proxyURL)\n  ) {\n    endpoint = options?.proxyURL as string;\n    if (isUndefinedOrEmpty(endpoint)) {\n      endpoint = input.proxyURL as string;\n    }\n    delete query.proxyURL;\n  } else {\n    if (isUndefinedOrEmpty(input.key) && typeof process !== 'undefined') {\n      query.key = process.env.OPENCAGE_API_KEY;\n    }\n    if (isUndefinedOrEmpty(query.key)) {\n      missingKey = true;\n    }\n  }\n  return {\n    missingKey,\n    endpoint,\n    query,\n  };\n}\n"],"names":["OPENCAGEDATA_JSON_URL","buildValidationError","code","message","error","GeocodeError","status","isUndefinedOrEmpty","param","isUndefinedOrNull","buildQueryString","input","Object","key","encodeURIComponent","buildQuery","options","query","endpoint","missingKey","process"],"mappings":";AAIA,MAAMA,wBAAwB;AAUvB,SAASC,qBAAqBC,IAAY,EAAEC,OAAe;IAChE,MAAMC,QAAQ,IAAIC,aAAaF;IAC/B,MAAMG,SAA6B;QACjCJ;QACAC;IACF;IACAC,MAAM,MAAM,GAAGE;IACfF,MAAM,QAAQ,GAAG;QAAEE;IAAO;IAC1B,OAAOF;AACT;AAQO,SAASG,mBAAmBC,KAAgC;IACjE,OAAO,AAAiB,WAAVA,SAAyBA,AAAU,OAAVA;AACzC;AAQO,SAASC,kBACdD,KAA0C;IAE1C,OAAO,QAAOA;AAChB;AAQO,SAASE,iBAAiBC,KAAU;IACzC,IAAIF,kBAAkBE,QACpB,OAAO;IAET,OAAOC,OAAO,IAAI,CAACD,OAChB,GAAG,CACF,CAACE,MACC,GAAGC,mBAAmBD,KAAK,CAAC,EAAEC,mBAAmBH,KAAK,CAACE,IAAI,IAAI,KAAK,EAEvE,IAAI,CAAC;AACV;AAcO,SAASE,WACdJ,KAAuB,EACvBK,OAA0B;IAE1B,MAAMC,QAAQ;QAAE,GAAGN,KAAK;IAAC;IACzB,IAAIO,WAAWlB;IACf,IAAImB,aAAa;IACjB,IACE,AAACZ,mBAAmBI,MAAM,QAAQ,KACjCJ,mBAAmBS,SAAS,WAOxB;QACL,IAAIT,mBAAmBI,MAAM,GAAG,KAAK,AAAmB,eAAnB,OAAOS,SAC1CH,MAAM,GAAG,GAAGG,QAAQ,GAAG,CAAC,gBAAgB;QAE1C,IAAIb,mBAAmBU,MAAM,GAAG,GAC9BE,aAAa;IAEjB,OAbE;QACAD,WAAWF,SAAS;QACpB,IAAIT,mBAAmBW,WACrBA,WAAWP,MAAM,QAAQ;QAE3B,OAAOM,MAAM,QAAQ;IACvB;IAQA,OAAO;QACLE;QACAD;QACAD;IACF;AACF"}